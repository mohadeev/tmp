<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Travsus Invoice</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				margin: 0;
				padding: 0;
				background-color: #f4f4f9;
			}
			.invoice-container {
				max-width: 800px;
				margin: 20px auto;
				background: #ffffff;
				padding: 20px;
				border: 1px solid #ddd;
				border-radius: 5px;
			}
			.header {
				text-align: center;
				margin-bottom: 20px;
			}
			.header img {
				max-width: 150px;
			}
			.header h1 {
				margin: 10px 0 5px;
				font-size: 24px;
			}
			.header p {
				margin: 0;
				color: #555;
			}
			.section {
				margin-bottom: 20px;
			}
			.section h2 {
				margin: 0 0 10px;
				font-size: 18px;
				border-bottom: 2px solid #f4f4f9;
				padding-bottom: 5px;
			}
			.details,
			.summary {
				width: 100%;
				border-collapse: collapse;
				margin-bottom: 20px;
			}
			.details th,
			.details td,
			.summary th,
			.summary td {
				border: 1px solid #ddd;
				padding: 8px;
			}
			.details th {
				background-color: #f4f4f9;
				text-align: left;
			}
			.summary th {
				background-color: #f4f4f9;
				text-align: left;
			}
			.total {
				font-weight: bold;
			}
			.footer {
				text-align: center;
				font-size: 14px;
				color: #555;
			}
		</style>
	</head>
	<body>
		<script>
			// Data for the invoice
			const invoiceData = {
				accommodation: {
					Standard: {
						single: { adult: 3, child: 3 },
						twin: { adult: 3, child: 2 },
						couple: { adult: 3, child: 2 },
					},
					Luxury: {
						single: { adult: 2, child: 2 },
						twin: { adult: 0, child: 0 },
						couple: { adult: 0, child: 0 },
					},
				},
				lineItems: [
					{
						description: 'accommodation',
						unitPrice: 37,
						totalPrice: 1110,
						totalGuests: 30,
						serviceQuantity: 1,
						includeInTotal: true,
						currency: 'EUR',
					},
					{
						description: 'transport',
						unitPrice: 26.67,
						totalPrice: 800,
						totalGuests: 30,
						serviceQuantity: 1,
						includeInTotal: true,
						currency: 'EUR',
					},
					{
						description: 'tax',
						unitPrice: 401.1,
						totalPrice: 401.1,
						totalGuests: 1,
						serviceQuantity: 1,
						includeInTotal: true,
						currency: 'EUR',
					},
				],
				selectedDate: { startDate: 1736204400000, endDate: 1736377200000 },
				id: '67536aad31dcd195d35de04f',
				customerId: '673a1768ec99ae645fc474a9',
				providerId: '673a1768ec99ae645fc474a9',
				tourId: '631e46a1027691bd18f0cfdd',
				duration: 10,
				orderNumber: 'TR-1000000029',
				receiptNumber: 'REC-1000000029',
				invoiceNumber: 'INV-1000000029',
				bookingReference: 'TRVS-24-1000000029',
				customer: {
					email: 'skendoulmohamed@gmail.com',
					username: 'Mohamed Skendoul',
					accountData: { firstname: 'Mohamed', lastname: 'Skendoul' },
				},
				tour: {
					name: '3 Days Sahara Desert Tour from Marrakech to Merzouga Desert Dunes ',
					subtitle: '3 Days Marrakech Trip from To Merzouga Dunes',
					accommodations: [
						{
							name: 'Luxury',
							pricingTiers: [
								{
									name: 'Luxury',
									bedOptions: [
										{ bedType: 'TWIN', basePrice: 100, currency: 'EUR' },
										{ bedType: 'SINGLE', basePrice: 50, currency: 'EUR' },
										{ bedType: 'COUPLE', basePrice: 100, currency: 'EUR' },
									],
								},
							],
						},
						{
							name: 'Standard',
							pricingTiers: [
								{
									name: 'Standard',
									bedOptions: [
										{ bedType: 'TWIN', basePrice: 70, currency: 'EUR' },
										{ bedType: 'SINGLE', basePrice: 35, currency: 'EUR' },
										{ bedType: 'COUPLE', basePrice: 70, currency: 'EUR' },
									],
								},
							],
						},
					],
				},
				paymentMethod: {
					last4: '4242',
					brand: 'visa',
					exp_month: 11,
					exp_year: 2029,
				},
			}

			// Function to generate the invoice HTML
			function generateInvoiceHTML(data) {
				const startDate = new Date(
					data.selectedDate.startDate,
				).toLocaleDateString()
				const endDate = new Date(data.selectedDate.endDate).toLocaleDateString()

				const accommodationPricing = {}
				data.tour.accommodations.forEach((acc) => {
					acc.pricingTiers[0].bedOptions.forEach((option) => {
						accommodationPricing[
							`${acc.name}_${option.bedType.toLowerCase()}`
						] = option.basePrice
					})
				})

				const accommodationRows = Object.entries(data.accommodation)
					.flatMap(([type, rooms]) =>
						Object.entries(rooms).flatMap(([roomType, guests]) => {
							const unitPrice = accommodationPricing[`${type}_${roomType}`]
							const adultCount = guests.adult
							const childCount = guests.child
							const totalGuests = adultCount + childCount
							const totalPrice = unitPrice * totalGuests
							return `
                            <tr>
                                <td>${type}</td>
                                <td>${roomType}</td>
                                <td>${adultCount}</td>
                                <td>${childCount}</td>
                                <td>${totalGuests}</td>
                                <td>EUR ${unitPrice.toFixed(2)}</td>
                                <td>EUR ${totalPrice.toFixed(2)}</td>
                            </tr>
                        `
						}),
					)
					.join('')

				const lineItemRows = data.lineItems
					.map(
						(item) => `
                    <tr>
                        <td>${item.description}</td>
                        <td>${item.totalGuests}</td>
                        <td>${item.currency} ${item.unitPrice.toFixed(2)}</td>
                        <td>${item.currency} ${item.totalPrice.toFixed(2)}</td>
                    </tr>
                `,
					)
					.join('')

				const total = data.lineItems.reduce(
					(sum, item) => sum + item.totalPrice,
					0,
				)

				return `
                <div class="invoice-container">
                    <!-- Header Section -->
                    <div class="header">
                        <img src="logo.png" alt="Travsus Logo">
                        <h1>Travsus Travel Agency</h1>
                        <p>Your Adventure Awaits</p>
                    </div>

                    <!-- Invoice Details -->
                    <div class="section">
                        <h2>Invoice Details</h2>
                        <table class="details">
                            <tr>
                                <th>Invoice Number:</th>
                                <td>${data.invoiceNumber}</td>
                            </tr>
                            <tr>
                                <th>Order Number:</th>
                                <td>${data.orderNumber}</td>
                            </tr>
                            <tr>
                                <th>Booking Reference:</th>
                                <td>${data.bookingReference}</td>
                            </tr>
                        </table>
                    </div>

                    <!-- Customer Information -->
                    <div class="section">
                        <h2>Customer Information</h2>
                        <table class="details">
                            <tr>
                                <th>Name:</th>
                                <td>${data.customer.accountData.firstname} ${data.customer.accountData.lastname}</td>
                            </tr>
                            <tr>
                                <th>Email:</th>
                                <td>${data.customer.email}</td>
                            </tr>
                        </table>
                    </div>

                    <!-- Tour Details -->
                    <div class="section">
                        <h2>Tour Details</h2>
                        <table class="details">
                            <tr>
                                <th>Tour Name:</th>
                                <td>${data.tour.name}</td>
                            </tr>
                            <tr>
                                <th>Duration:</th>
                                <td>${data.duration} days</td>
                            </tr>
                            <tr>
                                <th>Start Date:</th>
                                <td>${startDate}</td>
                            </tr>
                            <tr>
                                <th>End Date:</th>
                                <td>${endDate}</td>
                            </tr>
                        </table>
                    </div>

                    <!-- Accommodation Details -->
                    <div class="section">
                        <h2>Accommodation Details</h2>
                        <table class="details">
                            <tr>
                                <th>Type</th>
                                <th>Room</th>
                                <th>Adults</th>
                                <th>Children</th>
                                <th>Total Guests</th>
                                <th>Unit Price</th>
                                <th>Total Price</th>
                            </tr>
                            ${accommodationRows}
                        </table>
                    </div>

                    <!-- Services Provided -->
                    <div class="section">
                        <h2>Services Provided</h2>
                        <table class="details">
                            <tr>
                                <th>Service</th>
                                <th>Guests</th>
                                <th>Unit Price</th>
                                <th>Total</th>
                            </tr>
                            ${lineItemRows}
                        </table>
                    </div>

                    <!-- Financial Summary -->
                    <div class="section">
                        <h2>Financial Summary</h2>
                        <table class="summary">
                            <tr class="total">
                                <th>Total</th>
                                <td>EUR ${total.toFixed(2)}</td>
                            </tr>
                        </table>
                    </div>

                    <!-- Payment Method -->
                    <div class="section">
                        <h2>Payment Method</h2>
                        <p>Card: ${data.paymentMethod.brand.toUpperCase()} **** **** **** ${data.paymentMethod.last4}</p>
                        <p>Expiry: ${data.paymentMethod.exp_month}/${data.paymentMethod.exp_year}</p>
                    </div>

                    <!-- Notes and Terms -->
                    <div class="section">
                        <h2>Notes & Terms</h2>
                        <p>Thank you for choosing Travsus Travel Agency! For any questions or concerns, please contact our customer support.</p>
                    </div>

                    <!-- Footer -->
                    <div class="footer">
                        <p>Travsus Travel Agency | Email: support@travsus.com | Phone: +1234567890</p>
                    </div>
                </div>
            `
			}

			// Render the invoice HTML in the document body
			document.body.innerHTML = generateInvoiceHTML(invoiceData)
		</script>
	</body>
</html>
